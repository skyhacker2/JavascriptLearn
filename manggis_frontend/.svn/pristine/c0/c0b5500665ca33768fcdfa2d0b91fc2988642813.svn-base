<%
var rfl = require('rfl');
var langResourceCommon = require('lang/{{G.LANG}}/common');
var langResourceCustomer = require('lang/{{G.LANG}}/customer');
var langResourceCustomerImport = require('lang/{{G.LANG}}/customer-import');
%>

<h1>Here's what happened</h1>
<%if(data.status == 'completed' || data.status == 'completeValidation') {%>
	<%if(data.info.added || data.info.updated) {%>
		<div class="guiding success">
			<div class="icon-part">
				<i class="icon-smile"></i>
			</div>
			<div class="text-part">
				<h1>
					<%if(data.info.added && data.info.updated) {%>
						<%=data.info.added%> customers were added, and <%=data.info.updated%> customers were updated successfully.
					<%} else if(data.info.added) {%>
						<%=data.info.added%> customers were added successfully.
					<%} else {%>
						<%=data.info.updated%> customers were updated successfully.
					<%}%>
				</h1>
				<%if(data.info.added) {%>
					<div class="block block-info">
						<i class="icon-info-sign"></i> Dear, If you create a campaign, The spending speed for your newly import will be lower. 
					</div>
				<%}%>
				<a class="btn btn-success" href="html/customer/list-<%=G.LANG%>.html#!<%=listId%>"><i class="icon-circle-arrow-left"></i> Return to the list</a> <span class="text-gray"><%=langResourceCommon.label.or%></span> 
				<a class="text-gray" href="javascript:void(0);" onclick="return false;" data-rfl-click="importMoreCustomer">import more customers</a>
			</div>
		</div>
		<%if(data.info.notAdded) {%>
			<div class="block block-warning import-warning">
				<i class="icon-exclamation-sign"></i> <strong>But there were problems.</strong> And <%=data.info.notAdded%> customer wasn't added. See why below.
			</div>
		<%}%>
	<%} else if(data.info.notAdded) {%>
		<div class="guiding warning">
			<div class="icon-part">
				<i class="icon-meh"></i>
			</div>
			<div class="text-part">
				<h1><%=data.info.notAdded%> customer wasn't added. See why below.</h1>
				<a class="btn btn-warning" href="html/customer/list-<%=G.LANG%>.html#!<%=listId%>"><i class="icon-circle-arrow-left"></i> Return to the list</a> <span class="text-gray"><%=langResourceCommon.label.or%></span> 
				<a class="text-gray" href="javascript:void(0);" onclick="return false;" data-rfl-click="importMoreCustomer">import more customers</a>
			</div>
		</div>
	<%}%>
	<%
	var issues = data.info.issues;
	var maxColumns = 5;
	var maxRows = 5;
	var i, j, k, l, l2, l3, issue, customer;
	if(data.info.issues) {
	%>
		<div class="section-divider"></div>
	<%
		for(i = 0, l = issues.length; i < l; i++) {
			var issue = issues[i];
			var columnHeaders = issue.columnHeaders || data.info.columnHeaders;
			var text = langResourceCustomerImport.issues[issue.type] || langResourceCustomerImport.issues.unknown;
	%>
			<div class="section-collapse section-bordered <%=i > 0 ? 'collapse' : ''%>">
				<div class="section-title" data-toggle="section">
					<h2><i class="icon-caret-right"></i><i class="icon-caret-down"></i> <%=text.title%></h2>
				</div>
				<div class="section-content">
					<p class="desc"><%=text.content%></p>
					<div id="issue-content-<%=issue.type%>">
						<table class="table table-bordered section-sm" cellspacing="0" cellpadding="0" border="0">
							<tr>
								<%for(j = 0, l2 = columnHeaders.length; j < l2 && j < maxColumns; j++) {%>
									<th style="width: 150px;"><%==columnHeaders[j]%></th>
								<%}%>
							</tr>
							<%for(j = 0, l2 = issue.customers.length; j < l2 && j < maxRows; j++) {
								customer = issue.customers[j];
							%>
								<tr>
									<%for(k = 0, l3 = customer.length; k < l3 && k < maxColumns; k++) {%>
										<td><%==customer[k]%></td>
									<%}%>
								</tr>
							<%}%>
						</table>
						<div class="row">
							<div class="col-xs-6">
								<a class="btn btn-default btn-sm" href="<%=G.CGI_ORIGIN + G.CGI_BASE + issue.download%>" target="_blank"><i class="icon-download-alt"></i> Download all</a>
							</div>
							<div class="col-xs-6 text-right text-gray-light">
								Showing <%=Math.min(maxRows, issue.customers.length)%> of <%=issue.total%>
							</div>
							
						</div>
					</div>
				</div>
			</div>
	<%
		}
	}
	%>
<%} else if(data.status == 'inprogress') {%>
	<div class="guiding success">
		<div class="icon-part">
			<i class="icon-spin icon-spinner"></i>
		</div>
		<div class="text-part">
			<h1>The importing job is running in the background</h1>
			<div id="import-progress">
				<!-- include "./import-finished-progress.tpl.html" -->
			</div>
			<div id="import-email-notify" class="block display-none">
				<!-- include "./import-finished-notify-email.tpl.html" -->
			</div>
			<a class="btn btn-success" href="html/customer/list-<%=G.LANG%>.html#!<%=listId%>"><i class="icon-circle-arrow-left"></i> Return to the list</a> <span class="text-gray"><%=langResourceCommon.label.or%></span> 
			<a class="text-gray" href="javascript:void(0);" onclick="return false;" data-rfl-click="importMoreCustomer">import more customers</a>
		</div>
	</div>
<%} else {%>
	<div class="guiding error">
		<div class="icon-part">
			<i class="icon-frown"></i>
		</div>
		<div class="text-part">
			<h1>Sorry</h1>
			<p class="desc">
				The importing job is teminated due to service error. Please contact the administrator.
			</p>
			<a class="btn btn-danger" href="html/customer/list-<%=G.LANG%>.html#!<%=listId%>"><i class="icon-circle-arrow-left"></i> Return to the list</a> <span class="text-gray"><%=langResourceCommon.label.or%></span> 
			<a class="text-gray" href="javascript:void(0);" onclick="return false;" data-rfl-click="importMoreCustomer">import more customers</a>
		</div>
	</div>
<%}%>
