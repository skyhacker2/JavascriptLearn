<%
var langResourceCommon = require('lang/{{G.LANG}}/common');
var langResourceUser = require('lang/{{G.LANG}}/user');
%>

<h1><%=langResourceUser.label.manageUsers%></h1>
<div class="row section">
	<div class="col-md-3 col-sm-5">
		<%if(currentGroup.superGroup) {%>
			<select id="search-group" class="form-control responsive" tabindex="1" value="<%=groupId%>" onchange="G.pageRequire('../../js/mod/user/list').changeGroup();">
				<option value="">All Groups</option>
				<%for(var i = 0; i < groups.length; i++) {
					var group = groups[i];%>
					<option value="<%=group.id%>" <%=group.id == groupId ? 'selected="selected"' : ''%>><%=group.name%></option>
				<%}%>
			</select> 
		<%}%>
	</div>
	<div class="col-md-3 col-sm-1">
		<span class="batch-op-btns hidden">
			<button class="btn btn-default" data-rfl-click="delRows"><i class="icon-trash"></i></button> 
			<button class="btn btn-default" data-rfl-click="activateRows"><i class="icon-eye-open"></i></button> 
			<button class="btn btn-default" data-rfl-click="deactivateRows"><i class="icon-eye-close"></i></button> 
		</span>
	</div>
	<div class="col-md-6 col-sm-6 text-right">
		<%if(auth.hasPerm('PERM_USER_ADMIN')) {%>
			<a href="html/user/edit-<%=G.LANG%>.html" class="btn btn-primary responsive"><%=langResourceCommon.label.create%></a>
		<%}%>
	</div>
</div>
<table class="section table table-striped table-bordered table-responsive <%=G.IS_PC ? 'table-hover' : ''%>">
	<thead>
		<tr class="align-center">
			<th width="24">
				<label class="mockup-checkbox">
					<input type="checkbox" data-rfl-click="toggleDataTableAllRows #main-div" data-toggle="data-table-all-rows" />
					<span><i class="icon-ok"></i></span>
				</label>
			</th>
			<th width="300"><a class="text-gray" href="<%=G.resolveUrl('#!' + [page, 'email', (sortKey == 'email' && sortOrder == 'asc' ? 'desc' : 'asc'), groupId, searchText].join('/'))%>">
				<%=langResourceCommon.label.email%> 
				<%=sortKey == 'email' ? (sortOrder == 'desc' ? '<span class="sort-arrow-down"></span>' : '<span class="sort-arrow-up"></span>') : ''%>
			</a></th>
			<th><a class="text-gray" href="<%=G.resolveUrl('#!' + [page, 'firstName', (sortKey == 'firstName' && sortOrder == 'asc' ? 'desc' : 'asc'), groupId, searchText].join('/'))%>">
				<%=langResourceUser.label.firstName%> 
				<%=sortKey == 'firstName' ? (sortOrder == 'desc' ? '<span class="sort-arrow-down"></span>' : '<span class="sort-arrow-up"></span>') : ''%>
			</a></th>
			<th><a class="text-gray" href="<%=G.resolveUrl('#!' + [page, 'lastName', (sortKey == 'lastName' && sortOrder == 'asc' ? 'desc' : 'asc'), groupId, searchText].join('/'))%>">
				<%=langResourceUser.label.lastName%> 
				<%=sortKey == 'lastName' ? (sortOrder == 'desc' ? '<span class="sort-arrow-down"></span>' : '<span class="sort-arrow-up"></span>') : ''%>
			</a></th>
			<%if(!currentGroup.superGroup) {%>
				<th width="160"><%=langResourceUser.label.role%></th>
			<%}%>
			<th width="100"><a class="text-gray" href="<%=G.resolveUrl('#!' + [page, 'enabled', (sortKey == 'enabled' && sortOrder == 'asc' ? 'desc' : 'asc'), groupId, searchText].join('/'))%>">
				<%=langResourceCommon.label.active%> 
				<%=sortKey == 'enabled' ? (sortOrder == 'desc' ? '<span class="sort-arrow-down"></span>' : '<span class="sort-arrow-up"></span>') : ''%>
			</a></th>
			<th width="100"><%=langResourceCommon.label.operation%></th>
		</tr>
	</thead>
	<tbody>
	<%for(var i = 0; i < data.users.length; i++) {
		var item = data.users[i];%>
		<tr>
			<td class="mobile-hide">
				<%if(!item.superUser && item.id != currentUserId) {%>
					<label class="mockup-checkbox">
						<input type="checkbox" data-rfl-click="toggleDataTableRow #main-div" data-toggle="data-table-row" data-row-data="<%=i%>" />
						<span><i class="icon-ok"></i></span>
					</label>
				<%}%>
			</td>
			<%if(currentGroup.superGroup) {%>
				<td data-th="<%=langResourceCommon.label.email%> : " data-rfl-mouseover="showGroupAndRole <%=i%>" data-rfl-mouseout="hideGroupAndRole <%=i%>"><%==item.email%></td>
			<%} else {%>
				<td data-th="<%=langResourceCommon.label.email%> : "><%==item.email%></td>
			<%}%>
			<td data-th="<%=langResourceUser.label.firstName%> : "><%==item.firstName%></td>
			<td data-th="<%=langResourceUser.label.lastName%> : "><%==item.lastName%></td>
			<%
			var roleNames = '';
			if(!currentGroup.superGroup) {
				var groups = item.groups[0];
				var roles = groups && groups.roles || [];
				for(var n = 0; n < roles.length; n++) {
					roleNames += roles[n].name + '; '
				}%>
				<td data-th="<%=langResourceUser.label.role%> : " title="<%==roleNames%>" data-toggle="tooltip" data-container="body">
					<%==rfl.util.headByByte(roleNames, 22, '...')%>
				</td>
			<%}%>
			<td><div class="text-center"><%=item.enabled ? '<span class="icon-eye-open" title="' + langResourceCommon.label.active + '" data-toggle="tooltip"></span>' : '<span class="icon-eye-close text-gray-light" title="' + langResourceCommon.label.inactive + '" data-toggle="tooltip"></span>'%></div></td>
			<td>
				<div class="text-center">
					<%if(!item.superUser && item.id != currentUserId && auth.hasPerm('PERM_USER_ADMIN')) {%>
						<a href="html/user/edit-<%=G.LANG%>.html#id=<%=item.id%>" title="<%=langResourceCommon.label.edit%>" data-toggle="tooltip">&nbsp;<i class="icon-pencil"></i>&nbsp;</a>&nbsp;
						<a href="javascript:void(0);" onclick="return false;" data-rfl-click="delRow <%=i%>" title="<%=langResourceCommon.label.del%>" data-toggle="tooltip">&nbsp;<i class="icon-trash"></i>&nbsp;</a>&nbsp;
						<a href="javascript:void(0);" onclick="return false;" data-rfl-click="toggleActiveRow <%=i%>" title="<%=langResourceCommon.label.activate%> / <%=langResourceCommon.label.deactivate%>" data-toggle="tooltip">&nbsp;<i class="icon-retweet"></i>&nbsp;</a>
					<%}%>
				</div>
			</td>
		</tr>
	<%}%>
	<%if(!data.users.length) {%>
		<tr><td colspan="7"><div class="text-center"><%=langResourceCommon.msg.noResult%></div></td></tr>
	<%}%>
	</tbody>
</table>
<div class="row">
	<div class="col-md-6">
		<span class="batch-op-btns hidden">
				<button class="btn btn-default" data-rfl-click="delRows"><i class="icon-trash"></i></button> 
				<button class="btn btn-default" data-rfl-click="activateRows"><i class="icon-eye-open"></i></button> 
				<button class="btn btn-default" data-rfl-click="deactivateRows"><i class="icon-eye-close"></i></button> 
		</span>
	</div>
	<div class="col-md-6 pagination-right">
		<!-- include "../../../html/inc/ajax-history-pager.tpl.html" -->
	</div>
</div>
